<!DOCTYPE html>
<html>
<head>
    <title>位置情報を取得して保存</title>
</head>
<body>
    <h1>位置情報を取得して保存</h1>
    
    <div id="response"></div>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database-compat.js"></script>

    <script>
        // Firebaseの設定
        const firebaseConfig = {
            apiKey: "AIzaSyDGHRQsE7-YH0UxEJ8FvdShUr3_k3AoMQM",
            authDomain: "ip-add-47c83.firebaseapp.com",
            databaseURL: "https://ip-add-47c83-default-rtdb.firebaseio.com",
            projectId: "ip-add-47c83",
            storageBucket: "ip-add-47c83.appspot.com",
            messagingSenderId: "711426693718",
            appId: "1:711426693718:web:c4937017de3fc4830779f7"
        };

        // Firebaseアプリの初期化
        const app = firebase.initializeApp(firebaseConfig);
        const database = app.database();

        // ページがロードされたときに位置情報を取得して保存
        window.addEventListener("load", getLocationAndSave);

        function getLocationAndSave() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const userAgent = navigator.userAgent;
                    const ipAddress = "取得できません"; // ブラウザから直接 IP アドレスを取得する方法は制約があるため、代わりに "取得できません" としました。

                    // Google マップの URLを生成
                    const googleMapUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;

                    // Firebase Realtime Databaseへのデータ保存
                    const dbRef = database.ref('locations'); // 'locations'はデータベース内のコレクション名
                    const newLocationData = {
                        latitude: latitude,
                        longitude: longitude,
                        googleMapUrl: googleMapUrl,
                        userAgent: userAgent,
                        ipAddress: ipAddress,
                    };

                    // データをFirebase Realtime Databaseに追加
                    dbRef.push(newLocationData)
                        .then(() => {
                            // データの保存が成功した場合
                            const responseDiv = document.getElementById("response");
                            responseDiv.innerHTML = "位置情報が保存されました。";
                        })
                        .catch((error) => {
                            // データの保存が失敗した場合
                            const responseDiv = document.getElementById("response");
                            responseDiv.innerHTML = "エラーが発生しました: " + error.message;
                        });
                });
            } else {
                alert("位置情報を取得できません。");
            }
        }
    </script>
</body>
</html>
