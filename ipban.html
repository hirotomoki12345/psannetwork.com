<!DOCTYPE html>
<html>
<head>
    <title>IPアドレスチェック</title>
</head>
<body>
    <h1>ようこそ</h1>
    <p>IPアドレス: <span id="ipAddress"></span></p>
    <p>ユーザーエージェント: <span id="userAgent"></span></p>
    <p>位置情報: <span id="location"></span></p>
    <p>時間: <span id="timestamp"></span></p>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

    <script>
        // Firebaseの設定
        const firebaseConfig = {
  apiKey: "AIzaSyDGHRQsE7-YH0UxEJ8FvdShUr3_k3AoMQM",
  authDomain: "ip-add-47c83.firebaseapp.com",
  databaseURL: "https://ip-add-47c83-default-rtdb.firebaseio.com",
  projectId: "ip-add-47c83",
  storageBucket: "ip-add-47c83.appspot.com",
  messagingSenderId: "711426693718",
  appId: "1:711426693718:web:258764df678e37350779f7"
        };

        // Firebaseの初期化
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // IPアドレスを取得する
        fetch('https://ipinfo.io?callback')
            .then(res => res.text())
            .then(data => {
                const ipInfo = JSON.parse(data.replace(/.*\((.*)\)/, '$1'));
                const ip = ipInfo.ip;
                document.getElementById("ipAddress").textContent = ip;

                // ユーザーエージェントを取得
                const userAgent = navigator.userAgent;
                document.getElementById("userAgent").textContent = userAgent;

                // 位置情報を取得
                fetch('https://ipinfo.io/' + ip + '/json')
                    .then(res => res.json())
                    .then(data => {
                        const location = data.city + ', ' + data.region;
                        document.getElementById("location").textContent = location;

                        // 現在の時間を取得
                        const timestamp = new Date().toLocaleString();
                        document.getElementById("timestamp").textContent = timestamp;

                        // Firebase Realtime Databaseにデータを保存
                        const dataRef = ref(db, 'user-data');
                        const newDataRef = push(dataRef);

                        // データをオブジェクトとして保存
                        const userData = {
                            timestamp: timestamp,
                            ip: ip,
                            location: location,
                            userAgent: userAgent
                        };

                        set(newDataRef, userData)
                            .then(() => {
                                console.log('データがFirebaseに保存されました。');
                            })
                            .catch(error => {
                                console.error('データの保存中にエラーが発生しました: ', error);
                            });
                    })
                    .catch(error => {
                        console.error('位置情報の取得中にエラーが発生しました: ', error);
                    });
            })
            .catch(error => {
                console.error('IPアドレスの取得中にエラーが発生しました: ', error);
            });
    </script>
</body>
</html>
