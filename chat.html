<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Chat App</title>
    <!-- Add Firebase SDK script tags here -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js"></script>
</head>
<body>
    <div>
        <h1>Chat App</h1>
        <input type="text" id="jsi-name" placeholder="Your Name">
        <input type="text" id="jsi-msg" placeholder="Your Message">
        <button id="jsi-button">Send</button>
        <ul id="jsi-board"></ul>
    </div>

    <script>
        var CHAT = CHAT || {};

        CHAT.fire = {
            init: function () {
                this.setParameters();
                this.bindEvent();
            },

            setParameters: function () {
                this.$name = document.getElementById('jsi-name');
                this.$textArea = document.getElementById('jsi-msg');
                this.$board = document.getElementById('jsi-board');
                this.$button = document.getElementById('jsi-button');

                // Firebaseの設定
                var firebaseConfig = {
                    apiKey: "AIzaSyBVGCRikCSnxTCnnIHHK15711fUQJ50GL0",
                    authDomain: "hamanan1.firebaseapp.com",
                    projectId: "hamanan1",
                    storageBucket: "hamanan1.appspot.com",
                    messagingSenderId: "939524742350",
                    appId: "1:939524742350:web:114f1b698a5f4c1ec0049f"
                };

                // Firebaseアプリを初期化
                this.chatDataStore = firebase.initializeApp(firebaseConfig).database();

                // メッセージの取得
                this.chatDataStore.ref('talks').on('child_added', function (snapshot) {
                    var data = snapshot.val();
                    self.addText(data.user);
                    self.addText(data.message);
                });
            },

            bindEvent: function () {
                var self = this;
                this.$button.addEventListener('click', function () {
                    self.sendMsg();
                });
            },

            // ユーザー、メッセージ送信
            sendMsg: function () {
                var self = this;
                if (this.$textArea.value === '') {
                    return;
                }

                var name = this.$name.value;
                var text = this.$textArea.value;

                // データベースの中の「talks」に値を送り格納
                self.chatDataStore.ref('talks').push({ user: name, message: text });
                self.$textArea.value = '';
            },

            // 受け取り後の処理
            addText: function (data) {
                var msgDom = document.createElement('li');
                msgDom.innerHTML = data;
                this.$board.appendChild(msgDom);
            },
        };

        CHAT.fire.init();
    </script>
</body>
</html>
